# Setup Request Reset Password and Set New Password Pages
This guide covers implementing functional password reset request and password setting pages with form validation, email integration, and secure password update functionality using Vue.js and Laravel backend.

---

## Prerequisites

Before implementing the password reset functionality, ensure you have completed:
- Step 11.1: Setup Sign Up Page with Functional Implementation
- Step 11.2: Setup Email Verification Page with Functional Implementation  
- Step 11.3: Setup Sign In and Sign Out Pages with Authentication Management
- Laravel backend password reset system configured
- Email service configured for sending reset links

---

## 1. Update API Service Functions

### File: `src/functions/api/auth.js`
Add password reset request function to the existing auth service:

```javascript
export async function postSignUp(user) {
    return await axios.post(window.API_URL + '/signup', user);
}

export async function postSignIn(user) {
    return await axios.post(window.API_URL + '/signin', user);
}

export async function postSignOut(token) {
    return await axios.post(window.API_URL + '/signout', null, {
        headers: {
            Authorization: `Bearer ${token}`
        }
    });
}

export async function postRequestResetLink(user) {
    return await axios.post(window.API_URL + '/password/forgot', user);
}
```

### Function Purpose:
- **postRequestResetLink**: Sends password reset request to Laravel backend
- **Email Integration**: Triggers Laravel to send password reset email
- **Security**: Server validates email before sending reset link

---

## 2. Implement Request Password Reset Component

### File: `src/components/auth/ResetPassword.vue`
Update the reset password component to handle reset link requests:

```vue
<template>
  <div class="login-page">
    <div class="login-box">
      <div class="card card-outline card-primary">
        <div class="card-header text-center">
          <router-link to="/" class="h1"><b>Admin</b>LTE</router-link>
        </div>
        <div class="card-body">
          <p class="login-box-msg">Enter your email to receive a password reset link</p>
          <form @submit.prevent="requestResetLink">
            <div class="input-group mb-3">
              <input
                v-model="user.email"
                :class="{ 'is-invalid': !!userError.email }"
                type="email"
                class="form-control"
                placeholder="Email"
              />
              <div class="input-group-append">
                <div class="input-group-text">
                  <span class="fas fa-envelope"></span>
                </div>
              </div>
              <div class="invalid-feedback">
                {{ userError.email }}
              </div>
            </div>
            <div class="row">
              <div class="col-8"></div>
              <div class="col-4">
                <button type="submit" class="btn btn-primary btn-block">Send Link</button>
              </div>
            </div>
          </form>

          <p class="mb-1">
            <router-link :to="{ name: 'auth.signin' }" class="text-center"
              >Go back to login</router-link
            >
          </p>
          <p class="mb-0">
            <router-link :to="{ name: 'auth.signup' }" class="text-center"
              >Register a new membership</router-link
            >
          </p>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { useRouter } from "vue-router";
import { reactive } from "vue";
import { postRequestResetLink } from "@func/api/auth";
import { LoadingModal, MessageModal, CloseModal } from "@func/swal";
const router = useRouter();

const user = reactive({
  email: "",
});

const userError = reactive({
  email: "",
});

async function requestResetLink() {
  try {
    LoadingModal();
    const response = await postRequestResetLink(user);
    resetData();
    MessageModal("success", "Success", response.data.message);
  } catch (error) {
    if (!error.response) {
      return MessageModal("error", "Error", error.message);
    }
    if (error.response.status === 422) {
      Object.keys(userError).forEach((key) => {
        userError[key] = error.response.data.errors[key]
          ? error.response.data.errors[key][0]
          : "";
      });
      return CloseModal();
    }
    return MessageModal("error", "Error", error.response.data.message);
  }
}

const defaultUser = JSON.parse(JSON.stringify(user));
const defaultUserError = JSON.parse(JSON.stringify(userError));

function resetData() {
  Object.assign(user, defaultUser);
  Object.assign(userError, defaultUserError);
}
</script>
```

---

## 3. Implement Set New Password Component

### File: `src/components/auth/SetNewPassword.vue`
Update the set new password component to handle password updates via URL parameters:

```vue
<template>
  <div class="login-page">
    <div class="login-box">
      <div class="card card-outline card-primary">
        <div class="card-header text-center">
          <router-link to="/" class="h1"><b>Admin</b>LTE</router-link>
        </div>
        <div class="card-body">
          <p class="login-box-msg">Enter your new password</p>
          <form @submit.prevent="setNewPassword">
            <div class="input-group mb-3">
              <input
                v-model="user.password"
                type="password"
                class="form-control"
                :class="{ 'is-invalid': !!userError.password }"
                placeholder="Password"
              />
              <div class="input-group-append">
                <div class="input-group-text">
                  <span class="fas fa-lock"></span>
                </div>
              </div>
              <div class="invalid-feedback">
                {{ userError.password }}
              </div>
            </div>
            <div class="input-group mb-3">
              <input
                v-model="user.password_confirmation"
                type="password"
                class="form-control"
                placeholder="Confirm Password"
              />
              <div class="input-group-append">
                <div class="input-group-text">
                  <span class="fas fa-lock"></span>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-8"></div>
              <div class="col-4">
                <button type="submit" class="btn btn-primary btn-block">Reset</button>
              </div>
            </div>
          </form>
          <p class="mb-1">
            <router-link :to="{ name: 'auth.signin' }" class="text-center"
              >Go back to login</router-link
            >
          </p>
          <p class="mb-0">
            <router-link :to="{ name: 'auth.signup' }" class="text-center"
              >Register a new membership</router-link
            >
          </p>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { reactive } from "vue";
import { useRoute, useRouter } from "vue-router";
import { LoadingModal, MessageModal, CloseModal } from "@func/swal";
const route = useRoute();
const router = useRouter();

const user = reactive({
  password: "",
  password_confirmation: "",
});

const userError = reactive({
  password: "",
});

async function setNewPassword() {
  try {
    LoadingModal();
    const response = await axios.post(new URL(route.params.api_url), user);
    resetData();
    Swal.fire({
      title: response.data.message,
      text: "You can now sign in with your new password.",
      icon: "success",
      showCancelButton: true,
      confirmButtonColor: "#28a745",
      cancelButtonColor: "#d33",
      confirmButtonText: "Go to Sign In",
    }).then((result) => {
      if (result.isConfirmed) {
        router.push({ name: "auth.signin" });
      }
    });
  } catch (error) {
    if (!error.response) {
      return MessageModal("error", "Error", error.message);
    }
    if (error.response.status === 422) {
      Object.keys(userError).forEach((key) => {
        userError[key] = error.response.data.errors[key]
          ? error.response.data.errors[key][0]
          : "";
      });
      return CloseModal();
    }
    return MessageModal("error", "Error", error.response.data.message);
  }
}

const defaultUser = JSON.parse(JSON.stringify(user));
const defaultUserError = JSON.parse(JSON.stringify(userError));

function resetData() {
  Object.assign(user, defaultUser);
  Object.assign(userError, defaultUserError);
}
</script>
```

---

## 4. Understanding Password Reset Flow

### Complete Password Reset Process:

#### Step 1: Request Reset Link
```
User Email → Laravel API → Email Service → Password Reset Email → User's Inbox
```

#### Step 2: Email Link Structure
```
http://localhost:5173/password/reset/http%3A//localhost%3A8000/api/password/reset?token=xyz...&email=user@example.com
```

#### Step 3: Set New Password
```
Frontend Form → Encoded Laravel API URL → Password Update → Success Message
```

### URL Parameter Handling

#### Reset Password Route (from Router):
```javascript
{
  path: '/password/reset/:api_url',
  name: 'auth.set.password',
  component: SetNewPassword,
}
```

#### API URL Extraction:
```javascript
const response = await axios.post(new URL(route.params.api_url), user);
```
- **route.params.api_url**: Contains URL-encoded Laravel reset endpoint with token
- **new URL()**: Properly decodes the URL for axios request
- **Direct API Call**: Sends password data to Laravel backend

---

## 5. Request Reset Password Implementation Details

### Template Features:

#### Email Input with Validation
```vue
<input
  v-model="user.email"
  :class="{ 'is-invalid': !!userError.email }"
  type="email"
  class="form-control"
  placeholder="Email"
/>
<div class="invalid-feedback">
  {{ userError.email }}
</div>
```
- **Email Validation**: Server-side email validation with error display
- **Bootstrap Styling**: Professional form styling with validation states
- **Real-time Feedback**: Dynamic error display for user guidance

### Script Features:

#### Reset Link Request Function
```javascript
async function requestResetLink() {
  try {
    LoadingModal();
    const response = await postRequestResetLink(user);
    resetData();
    MessageModal("success", "Success", response.data.message);
  } catch (error) {
    // Error handling...
  }
}
```

### Key Implementation Steps:
1. **Loading State**: Shows loading modal during API request
2. **API Call**: Sends email to Laravel backend
3. **Success Message**: Displays server confirmation message
4. **Form Reset**: Clears form data for security
5. **Error Handling**: Manages validation and network errors

---

## 6. Set New Password Implementation Details

### Template Features:

#### Password Input Fields
```vue
<input
  v-model="user.password"
  type="password"
  :class="{ 'is-invalid': !!userError.password }"
  placeholder="Password"
/>
<input
  v-model="user.password_confirmation"
  type="password"
  placeholder="Confirm Password"
/>
```
- **Password Confirmation**: Ensures password accuracy through double-entry
- **Validation Feedback**: Shows password requirements errors
- **Secure Input**: Password fields hide sensitive data

### Script Features:

#### Password Update Function
```javascript
async function setNewPassword() {
  try {
    LoadingModal();
    const response = await axios.post(new URL(route.params.api_url), user);
    resetData();
    Swal.fire({
      title: response.data.message,
      text: "You can now sign in with your new password.",
      icon: "success",
      showCancelButton: true,
      confirmButtonColor: "#28a745",
      cancelButtonColor: "#d33",
      confirmButtonText: "Go to Sign In",
    }).then((result) => {
      if (result.isConfirmed) {
        router.push({ name: "auth.signin" });
      }
    });
  } catch (error) {
    // Error handling...
  }
}
```

### Key Features:
1. **URL Parameter Processing**: Extracts and decodes Laravel API URL
2. **Password Submission**: Sends new password to backend
3. **Success Modal**: Interactive confirmation with navigation option
4. **Automatic Redirect**: Optional navigation to sign-in page
5. **Form Reset**: Clears sensitive data after completion

---

## 7. Error Handling Strategies

### Reset Link Request Errors:

#### Email Validation Errors (422)
```javascript
if (error.response.status === 422) {
  Object.keys(userError).forEach((key) => {
    userError[key] = error.response.data.errors[key]
      ? error.response.data.errors[key][0]
      : "";
  });
  return CloseModal();
}
```
- **Field Validation**: Maps Laravel validation errors to form fields
- **User Guidance**: Shows specific error messages below input fields

#### Common Reset Request Errors:
- **Invalid Email**: Email not found in system
- **Rate Limiting**: Too many reset requests
- **Email Service Issues**: SMTP configuration problems

---

## Conclusion

You now have a complete password reset system with:

✅ **Reset Request Functionality**: Email-based password reset initiation  
✅ **Password Update System**: Secure new password setting via email links  
✅ **Form Validation**: Comprehensive client-side and server-side validation  
✅ **Security Implementation**: Token-based security with expiration  
✅ **User Experience**: Clear feedback and navigation throughout the process  
✅ **Error Handling**: Robust error management for all failure scenarios  
✅ **Laravel Integration**: Complete backend integration with email services  
✅ **Production Ready**: Security considerations and best practices implemented  

The password reset system provides a secure and user-friendly way for users to recover their accounts while maintaining high security standards and proper validation.